"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.AwsMicroservicesStack = void 0;
const aws_cdk_lib_1 = require("aws-cdk-lib");
const apigateway_1 = require("./apigateway");
const database_1 = require("./database");
const eventbus_1 = require("./eventbus");
const microservice_1 = require("./microservice");
const queue_1 = require("./queue");
class AwsMicroservicesStack extends aws_cdk_lib_1.Stack {
    constructor(scope, id, props) {
        super(scope, id, props);
        const database = new database_1.SwnDatabase(this, 'Database');
        const microservices = new microservice_1.SwnMicroservices(this, 'Microservices', {
            productTable: database.productTable,
            basketTable: database.basketTable,
            orderTable: database.orderTable
        });
        const apigateway = new apigateway_1.SwnApiGateway(this, 'ApiGateway', {
            productMicroservice: microservices.productMicroservice,
            basketMicroservice: microservices.basketMicroservice,
            orderingMicroservices: microservices.orderingMicroservice
        });
        const queue = new queue_1.SwnQueue(this, 'Queue', {
            consumer: microservices.orderingMicroservice
        });
        const eventbus = new eventbus_1.SwnEventBus(this, 'EventBus', {
            publisherFuntion: microservices.basketMicroservice,
            targetQueue: queue.orderQueue
        });
    }
}
exports.AwsMicroservicesStack = AwsMicroservicesStack;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXdzLW1pY3Jvc2VydmljZXMtc3RhY2suanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJhd3MtbWljcm9zZXJ2aWNlcy1zdGFjay50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFBQSw2Q0FBZ0Q7QUFFaEQsNkNBQTZDO0FBQzdDLHlDQUF5QztBQUN6Qyx5Q0FBeUM7QUFDekMsaURBQWtEO0FBQ2xELG1DQUFtQztBQUVuQyxNQUFhLHFCQUFzQixTQUFRLG1CQUFLO0lBQzlDLFlBQVksS0FBZ0IsRUFBRSxFQUFVLEVBQUUsS0FBa0I7UUFDMUQsS0FBSyxDQUFDLEtBQUssRUFBRSxFQUFFLEVBQUUsS0FBSyxDQUFDLENBQUM7UUFFeEIsTUFBTSxRQUFRLEdBQUcsSUFBSSxzQkFBVyxDQUFDLElBQUksRUFBRSxVQUFVLENBQUMsQ0FBQztRQUVuRCxNQUFNLGFBQWEsR0FBRyxJQUFJLCtCQUFnQixDQUFDLElBQUksRUFBRSxlQUFlLEVBQUU7WUFDaEUsWUFBWSxFQUFFLFFBQVEsQ0FBQyxZQUFZO1lBQ25DLFdBQVcsRUFBRSxRQUFRLENBQUMsV0FBVztZQUNqQyxVQUFVLEVBQUUsUUFBUSxDQUFDLFVBQVU7U0FDaEMsQ0FBQyxDQUFDO1FBRUgsTUFBTSxVQUFVLEdBQUcsSUFBSSwwQkFBYSxDQUFDLElBQUksRUFBRSxZQUFZLEVBQUU7WUFDdkQsbUJBQW1CLEVBQUUsYUFBYSxDQUFDLG1CQUFtQjtZQUN0RCxrQkFBa0IsRUFBRSxhQUFhLENBQUMsa0JBQWtCO1lBQ3BELHFCQUFxQixFQUFFLGFBQWEsQ0FBQyxvQkFBb0I7U0FDMUQsQ0FBQyxDQUFDO1FBRUgsTUFBTSxLQUFLLEdBQUcsSUFBSSxnQkFBUSxDQUFDLElBQUksRUFBRSxPQUFPLEVBQUU7WUFDeEMsUUFBUSxFQUFFLGFBQWEsQ0FBQyxvQkFBb0I7U0FDN0MsQ0FBQyxDQUFDO1FBRUgsTUFBTSxRQUFRLEdBQUcsSUFBSSxzQkFBVyxDQUFDLElBQUksRUFBRSxVQUFVLEVBQUU7WUFDakQsZ0JBQWdCLEVBQUUsYUFBYSxDQUFDLGtCQUFrQjtZQUNsRCxXQUFXLEVBQUUsS0FBSyxDQUFDLFVBQVU7U0FDOUIsQ0FBQyxDQUFDO0lBRUwsQ0FBQztDQUNGO0FBNUJELHNEQTRCQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFN0YWNrLCBTdGFja1Byb3BzIH0gZnJvbSAnYXdzLWNkay1saWInO1xyXG5pbXBvcnQgeyBDb25zdHJ1Y3QgfSBmcm9tICdjb25zdHJ1Y3RzJztcclxuaW1wb3J0IHsgU3duQXBpR2F0ZXdheSB9IGZyb20gJy4vYXBpZ2F0ZXdheSc7XHJcbmltcG9ydCB7IFN3bkRhdGFiYXNlIH0gZnJvbSAnLi9kYXRhYmFzZSc7XHJcbmltcG9ydCB7IFN3bkV2ZW50QnVzIH0gZnJvbSAnLi9ldmVudGJ1cyc7XHJcbmltcG9ydCB7IFN3bk1pY3Jvc2VydmljZXMgfSBmcm9tICcuL21pY3Jvc2VydmljZSc7XHJcbmltcG9ydCB7IFN3blF1ZXVlIH0gZnJvbSAnLi9xdWV1ZSc7XHJcblxyXG5leHBvcnQgY2xhc3MgQXdzTWljcm9zZXJ2aWNlc1N0YWNrIGV4dGVuZHMgU3RhY2sge1xyXG4gIGNvbnN0cnVjdG9yKHNjb3BlOiBDb25zdHJ1Y3QsIGlkOiBzdHJpbmcsIHByb3BzPzogU3RhY2tQcm9wcykge1xyXG4gICAgc3VwZXIoc2NvcGUsIGlkLCBwcm9wcyk7XHJcblxyXG4gICAgY29uc3QgZGF0YWJhc2UgPSBuZXcgU3duRGF0YWJhc2UodGhpcywgJ0RhdGFiYXNlJyk7ICAgIFxyXG5cclxuICAgIGNvbnN0IG1pY3Jvc2VydmljZXMgPSBuZXcgU3duTWljcm9zZXJ2aWNlcyh0aGlzLCAnTWljcm9zZXJ2aWNlcycsIHtcclxuICAgICAgcHJvZHVjdFRhYmxlOiBkYXRhYmFzZS5wcm9kdWN0VGFibGUsXHJcbiAgICAgIGJhc2tldFRhYmxlOiBkYXRhYmFzZS5iYXNrZXRUYWJsZSxcclxuICAgICAgb3JkZXJUYWJsZTogZGF0YWJhc2Uub3JkZXJUYWJsZVxyXG4gICAgfSk7XHJcblxyXG4gICAgY29uc3QgYXBpZ2F0ZXdheSA9IG5ldyBTd25BcGlHYXRld2F5KHRoaXMsICdBcGlHYXRld2F5Jywge1xyXG4gICAgICBwcm9kdWN0TWljcm9zZXJ2aWNlOiBtaWNyb3NlcnZpY2VzLnByb2R1Y3RNaWNyb3NlcnZpY2UsXHJcbiAgICAgIGJhc2tldE1pY3Jvc2VydmljZTogbWljcm9zZXJ2aWNlcy5iYXNrZXRNaWNyb3NlcnZpY2UsXHJcbiAgICAgIG9yZGVyaW5nTWljcm9zZXJ2aWNlczogbWljcm9zZXJ2aWNlcy5vcmRlcmluZ01pY3Jvc2VydmljZVxyXG4gICAgfSk7XHJcbiAgICBcclxuICAgIGNvbnN0IHF1ZXVlID0gbmV3IFN3blF1ZXVlKHRoaXMsICdRdWV1ZScsIHtcclxuICAgICAgY29uc3VtZXI6IG1pY3Jvc2VydmljZXMub3JkZXJpbmdNaWNyb3NlcnZpY2VcclxuICAgIH0pO1xyXG5cclxuICAgIGNvbnN0IGV2ZW50YnVzID0gbmV3IFN3bkV2ZW50QnVzKHRoaXMsICdFdmVudEJ1cycsIHtcclxuICAgICAgcHVibGlzaGVyRnVudGlvbjogbWljcm9zZXJ2aWNlcy5iYXNrZXRNaWNyb3NlcnZpY2UsXHJcbiAgICAgIHRhcmdldFF1ZXVlOiBxdWV1ZS5vcmRlclF1ZXVlICAgXHJcbiAgICB9KTsgICBcclxuXHJcbiAgfVxyXG59XHJcbiJdfQ==